generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
  binaryTargets   = ["native", "debian-openssl-3.0.x", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ProgramFrequency {
  daily
  weekly
  monthly
  adhoc
  block_only
}

enum ProgramMode {
  single
  flow
}

enum ProgramType {
  routine
  training
  healing
  social
  business
  spiritual
  brain
}

enum ProgramPriority {
  core
  optional
}

enum ProgramStatus {
  active
  archived
  experimental
}

enum ProgramStateIntent {
  love
  happiness
  pride
  power
  calm
  focus
  gratitude
  energy
}

enum ProgramTimeWindow {
  morning_block
  midday_block
  evening_block
  business_block
  family_block
  focus_block
}

enum ProgramCategory {
  mind
  body
  human
  environment
  business
}

enum ExerciseType {
  checkbox
  scale
  multiselect
  text
  number
  html
}

enum HumanContactRelation {
  family
  friend
  colleague
  business_partner
  network
}

enum HumanContactActivity {
  whatsapp
  call
  email
  meeting
  video_call
}

enum HumanContactCadence {
  daily
  weekly
}

enum XpTransactionType {
  earn
  spend
}

enum JournalType {
  learn
  success
  gratitude
}

enum RewardStatus {
  pending
  approved
  rejected
  cancelled
}

enum RequirementStatus {
  open
  in_progress
  problem
  done
}

enum RequirementArea {
  privat
  finanzen
  arbeit
  staat
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      String   @default("user")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  runs              ProgramRun[]
  xp                XpTransaction[]
  rewards           RewardRedemption[]
  journals          Journal[]
  journalLogs       JournalEntry[]
  requirementLogs   RequirementLog[]
  goalCheckins      MindGoalCheckin[]
  brainSessions     BrainExerciseSession[]
  milestoneProgress LearningMilestoneProgress[]
  emotionLogs       EmotionLog[]
  requirements      Requirement[]
  householdEntries  HouseholdEntry[]
  humanContactLogs  HumanContactLog[]
  readingLogs       MindReadingLog[]
}

model Program {
  id                String              @id @default(cuid())
  slug              String              @unique
  code              String
  name              String
  summary           String
  category          ProgramCategory
  frequency         ProgramFrequency
  durationMinutes   Int
  xpReward          Int
  mode              ProgramMode
  programType       ProgramType         @default(routine)
  priority          ProgramPriority     @default(optional)
  status            ProgramStatus       @default(active)
  defaultTimeWindow ProgramTimeWindow?
  version           Int                 @default(1)
  linkedGoalIds     String[]            @default([])
  expectedOutcome   String?
  desiredState      ProgramStateIntent?
  roleTags          String[]            @default([])
  stateCheckBefore  Boolean             @default(false)
  stateCheckAfter   Boolean             @default(false)
  ritual            Json?
  quality           Json?
  result            Json?
  xpRules           Json?
  runnerConfig      Json?
  scheduling        Json?
  menuLogic         Json?
  createdAt         DateTime            @default(now())

  units ProgramUnit[]
  runs  ProgramRun[]
}

model ProgramUnit {
  id        String @id @default(cuid())
  programId String
  title     String
  order     Int

  program   Program    @relation(fields: [programId], references: [id])
  exercises Exercise[]
}

model Exercise {
  id          String       @id @default(cuid())
  unitId      String
  label       String
  description String?
  type        ExerciseType
  config      Json?
  xpValue     Int          @default(0)

  unit ProgramUnit @relation(fields: [unitId], references: [id])
}

model ProgramRun {
  id        String      @id @default(cuid())
  programId String
  userId    String
  mode      ProgramMode
  xpEarned  Int
  answers   Json
  createdAt DateTime    @default(now())

  program Program         @relation(fields: [programId], references: [id])
  user    User            @relation(fields: [userId], references: [id])
  xp      XpTransaction[]
  householdEntries HouseholdEntry[]
}

model ProgramStack {
  id           String   @id @default(cuid())
  slug         String   @unique
  title        String
  summary      String
  programSlugs String[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model XpTransaction {
  id                 String            @id @default(cuid())
  userId             String
  category           ProgramCategory
  amount             Int
  type               XpTransactionType
  source             String
  programRunId       String?
  rewardRedemptionId String?
  createdAt          DateTime          @default(now())

  user       User              @relation(fields: [userId], references: [id])
  programRun ProgramRun?       @relation(fields: [programRunId], references: [id])
  reward     RewardRedemption? @relation(fields: [rewardRedemptionId], references: [id])
}

model Reward {
  id          String  @id @default(cuid())
  name        String
  description String
  cost        Int
  active      Boolean @default(true)

  redemptions RewardRedemption[]
}

model RewardRedemption {
  id          String       @id @default(cuid())
  rewardId    String
  userId      String
  status      RewardStatus @default(pending)
  requestedAt DateTime     @default(now())
  resolvedAt  DateTime?
  notes       String?

  reward Reward          @relation(fields: [rewardId], references: [id])
  user   User            @relation(fields: [userId], references: [id])
  xp     XpTransaction[]
}

model Requirement {
  id          String            @id @default(cuid())
  title       String
  description String?
  targetDate  DateTime?
  requester   String
  cost        Int
  priority    Int               @default(3)
  xp          Int               @default(0)
  area        RequirementArea
  status      RequirementStatus @default(open)
  userId      String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  user User?            @relation(fields: [userId], references: [id])
  logs RequirementLog[]
}

model RequirementLog {
  id            String   @id @default(cuid())
  requirementId String
  userId        String?
  content       String
  createdAt     DateTime @default(now())

  requirement Requirement @relation(fields: [requirementId], references: [id], onDelete: Cascade)
  user        User?       @relation(fields: [userId], references: [id])

  @@index([requirementId], map: "RequirementLog_requirementId_idx")
}

model Journal {
  id     String      @id @default(cuid())
  userId String
  name   String
  type   JournalType

  user    User           @relation(fields: [userId], references: [id])
  entries JournalEntry[]
}

model JournalEntry {
  id          String   @id @default(cuid())
  journalId   String
  userId      String?
  contentHtml String
  createdAt   DateTime @default(now())

  journal Journal @relation(fields: [journalId], references: [id])
  user    User?   @relation(fields: [userId], references: [id])
}

model MindVisualizationAsset {
  id        String   @id @default(cuid())
  title     String
  imageData String
  order     Int      @default(0)
  createdAt DateTime @default(now())
}

model MindGoal {
  id          String    @id @default(cuid())
  title       String
  specific    String
  measurable  String
  achievable  String
  relevant    String
  timeBound   String
  metricName  String?
  targetValue Int?
  unit        String?
  targetDate  DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  checkins MindGoalCheckin[]
}

model MindGoalCheckin {
  id              String   @id @default(cuid())
  goalId          String
  userId          String?
  progressPercent Int
  selfAssessment  String?
  readThrough     Boolean  @default(false)
  createdAt       DateTime @default(now())

  goal MindGoal @relation(fields: [goalId], references: [id])
  user User?    @relation(fields: [userId], references: [id])
}

model BrainExercise {
  id              String   @id @default(cuid())
  title           String
  focusArea       String
  description     String
  difficulty      Int
  durationMinutes Int
  rating          Int?
  createdAt       DateTime @default(now())

  sessions BrainExerciseSession[]
}

model BrainExerciseSession {
  id          String   @id @default(cuid())
  exerciseId  String
  userId      String?
  rating      Int?
  notes       String?
  completedAt DateTime @default(now())

  exercise BrainExercise @relation(fields: [exerciseId], references: [id])
  user     User?         @relation(fields: [userId], references: [id])
}

model LearningPath {
  id          String   @id @default(cuid())
  title       String
  theme       String
  description String
  createdAt   DateTime @default(now())

  milestones LearningMilestone[]
}

model LearningMilestone {
  id          String @id @default(cuid())
  pathId      String
  title       String
  description String
  order       Int

  path     LearningPath                @relation(fields: [pathId], references: [id])
  progress LearningMilestoneProgress[]
}

model LearningMilestoneProgress {
  id          String   @id @default(cuid())
  milestoneId String
  userId      String?
  completed   Boolean  @default(false)
  updatedAt   DateTime @updatedAt

  milestone LearningMilestone @relation(fields: [milestoneId], references: [id])
  user      User?             @relation(fields: [userId], references: [id])

  @@unique([milestoneId, userId])
}

model EmotionPractice {
  id              String   @id @default(cuid())
  emotion         String
  summary         String
  regulationSteps Json
  groundingPrompt String?
  createdAt       DateTime @default(now())

  logs EmotionLog[]
}

model EmotionLog {
  id           String   @id @default(cuid())
  userId       String?
  practiceId   String?
  emotionLabel String
  intensity    Int
  note         String?
  createdAt    DateTime @default(now())

  practice EmotionPractice? @relation(fields: [practiceId], references: [id])
  user     User?            @relation(fields: [userId], references: [id])
}

model MindMeditationFlow {
  id        String   @id @default(cuid())
  title     String
  subtitle  String?
  summary   String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  steps MindMeditationStep[]
}

model PerformanceChecklistItem {
  id        String   @id @default(cuid())
  label     String
  summary   String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model MindReadingBook {
  id        String   @id @default(cuid())
  title     String
  author    String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  logs MindReadingLog[]
}

model MindReadingLog {
  id        String   @id @default(cuid())
  bookId    String
  userId    String?
  pages     Int
  createdAt DateTime @default(now())

  book MindReadingBook @relation(fields: [bookId], references: [id], onDelete: Cascade)
  user User?           @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([bookId])
}

model MindMeditationStep {
  id          String   @id @default(cuid())
  flowId      String
  title       String
  description String?
  order       Int      @default(0)
  createdAt   DateTime @default(now())

  flow MindMeditationFlow @relation(fields: [flowId], references: [id], onDelete: Cascade)

  @@index([flowId, order])
}

model HouseholdTask {
  id        String   @id @default(cuid())
  label     String
  order     Int      @default(0)
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  cards HouseholdCardTask[]
}

model HouseholdCard {
  id        String   @id @default(cuid())
  title     String
  weekday   Int
  summary   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tasks   HouseholdCardTask[]
  entries HouseholdEntry[]
}

model HouseholdCardTask {
  id     String @id @default(cuid())
  cardId String
  taskId String
  order  Int    @default(0)

  card HouseholdCard @relation(fields: [cardId], references: [id], onDelete: Cascade)
  task HouseholdTask @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([cardId, taskId])
}

model HouseholdEntry {
  id               String   @id @default(cuid())
  cardId           String
  userId           String
  programRunId     String?
  completedTaskIds String[] @default([])
  note             String?
  createdAt        DateTime @default(now())

  card       HouseholdCard @relation(fields: [cardId], references: [id])
  user       User           @relation(fields: [userId], references: [id])
  programRun ProgramRun?    @relation(fields: [programRunId], references: [id])

  @@index([createdAt])
  @@index([cardId])
}

model HumanContactPerson {
  id        String               @id @default(cuid())
  name      String
  relation  HumanContactRelation
  note      String?
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt

  assignments HumanContactAssignment[]
  logs        HumanContactLog[]
}

model HumanContactAssignment {
  id        String              @id @default(cuid())
  personId  String
  activity  HumanContactActivity
  cadence   HumanContactCadence
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt

  person HumanContactPerson @relation(fields: [personId], references: [id], onDelete: Cascade)

  @@unique([personId, activity, cadence])
  @@index([personId])
}

model HumanContactLog {
  id        String              @id @default(cuid())
  personId  String
  userId    String?
  activity  HumanContactActivity
  note      String?
  createdAt DateTime            @default(now())

  person HumanContactPerson @relation(fields: [personId], references: [id], onDelete: Cascade)
  user   User?             @relation(fields: [userId], references: [id])

  @@index([personId, createdAt])
}
